import React, { useState, useEffect } from 'react';\nimport { Clock, User, Hash, Activity } from 'lucide-react';\nimport './AuditLog.css';\n\nconst AuditLog = () => {\n    const [logs, setLogs] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState('');\n    const [selectedUser, setSelectedUser] = useState('');\n\n    useEffect(() => {\n        fetchAuditLog();\n        // Refresh every 30 seconds for live updates\n        const interval = setInterval(fetchAuditLog, 30000);\n        return () => clearInterval(interval);\n    }, []);\n\n    const fetchAuditLog = async () => {\n        try {\n            setLoading(true);\n            const response = await fetch(`${import.meta.env.PROD ? 'https://rumor-system-backend.onrender.com' : 'http://localhost:3000'}/api/audit/log?limit=50`);\n            const data = await response.json();\n            setLogs(data.logs || []);\n        } catch (err) {\n            setError('Failed to load audit log');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const formatTimestamp = (timestamp) => {\n        return new Date(timestamp).toLocaleString();\n    };\n\n    const getActionIcon = (actionType) => {\n        switch (actionType) {\n            case 'REGISTER': return 'ðŸ‘¤';\n            case 'SUBMIT': return 'ðŸ“';\n            case 'VOTE': return 'ðŸ—³ï¸';\n            case 'DELETE': return 'ðŸ—‘ï¸';\n            case 'FINALIZE': return 'ðŸ”’';\n            default: return 'âš¡';\n        }\n    };\n\n    const truncateHash = (hash, length = 12) => {\n        return hash ? `${hash.substring(0, length)}...${hash.substring(hash.length - 4)}` : 'N/A';\n    };\n\n    const filteredLogs = selectedUser \n        ? logs.filter(log => log.actor_public_key === selectedUser)\n        : logs;\n\n    const uniqueUsers = [...new Set(logs.map(log => log.actor_public_key).filter(Boolean))];\n\n    return (\n        <div className=\"audit-log-container\">\n            <div className=\"audit-header\">\n                <h2 className=\"audit-title\">\n                    <Activity size={24} style={{ marginRight: '10px' }} />\n                    Public Audit Trail\n                </h2>\n                <p className=\"audit-subtitle\">\n                    ðŸ”— Blockchain-like transparency â€¢ All actions are cryptographically verifiable\n                </p>\n                \n                <div className=\"audit-stats\">\n                    <div className=\"stat-item\">\n                        <span className=\"stat-number\">{logs.length}</span>\n                        <span className=\"stat-label\">Total Actions</span>\n                    </div>\n                    <div className=\"stat-item\">\n                        <span className=\"stat-number\">{uniqueUsers.length}</span>\n                        <span className=\"stat-label\">Active Users</span>\n                    </div>\n                    <div className=\"stat-item\">\n                        <span className=\"stat-number\">{logs.filter(l => l.action_type === 'VOTE').length}</span>\n                        <span className=\"stat-label\">Total Votes</span>\n                    </div>\n                </div>\n\n                <div className=\"audit-filters\">\n                    <select \n                        value={selectedUser} \n                        onChange={(e) => setSelectedUser(e.target.value)}\n                        className=\"user-filter\"\n                    >\n                        <option value=\"\">All Users</option>\n                        {uniqueUsers.map(user => (\n                            <option key={user} value={user}>\n                                {truncateHash(user, 8)}\n                            </option>\n                        ))}\n                    </select>\n                    <button onClick={fetchAuditLog} className=\"refresh-btn\">\n                        ðŸ”„ Refresh\n                    </button>\n                </div>\n            </div>\n\n            <div className=\"audit-content\">\n                {loading ? (\n                    <div className=\"audit-loading\">Loading public audit trail...</div>\n                ) : error ? (\n                    <div className=\"audit-error\">{error}</div>\n                ) : (\n                    <div className=\"audit-timeline\">\n                        {filteredLogs.map((log, index) => (\n                            <div key={index} className={`audit-entry ${log.action_type.toLowerCase()}`}>\n                                <div className=\"audit-icon\">\n                                    {getActionIcon(log.action_type)}\n                                </div>\n                                \n                                <div className=\"audit-details\">\n                                    <div className=\"audit-action\">\n                                        <strong>{log.action_type}</strong>\n                                        {log.target_id && (\n                                            <span className=\"target-id\">#{log.target_id}</span>\n                                        )}\n                                    </div>\n                                    \n                                    <div className=\"audit-meta\">\n                                        <div className=\"audit-time\">\n                                            <Clock size={12} />\n                                            {formatTimestamp(log.timestamp)}\n                                        </div>\n                                        \n                                        {log.actor_public_key && (\n                                            <div className=\"audit-actor\">\n                                                <User size={12} />\n                                                {truncateHash(log.actor_public_key)}\n                                            </div>\n                                        )}\n                                        \n                                        <div className=\"audit-hash\">\n                                            <Hash size={12} />\n                                            {truncateHash(log.data_hash)}\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                        \n                        {filteredLogs.length === 0 && (\n                            <div className=\"audit-empty\">\n                                No audit entries found.\n                            </div>\n                        )}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default AuditLog;